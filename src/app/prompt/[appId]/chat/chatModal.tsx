import React, { useState, useEffect } from 'react'
import Avatar from 'react-avatar'
import { Markdown } from '../../../../components/base/markdown'
import Image from 'next/image'
import { MODEL_LIST } from '../../../../consts/modelheaderData'
import { record as actionApi } from '../../../../services/chat'
import { toast } from 'react-toastify'
import copy from 'copy-to-clipboard'

const params={
  1:'点赞成功',
  2:'成功吐槽',
  3:'复制成功'
}
const ChatModal = ({ record, appDetail, messageRef, appColor, modelId, onReload }: any) => {
  const [avatar, setAvatar] = useState('')

  useEffect(() => {
    const userInfo = localStorage.getItem('userInfo') || '{}'
    setAvatar(JSON.parse(userInfo)?.headimg_url || '')
  }, [])

  const action = async (item: { id: any; content: string }, type: number) => {
    const appRecordRes = await actionApi({
      id: item.id,
      type,
    })
    
    if (appRecordRes?.code === 0) {
      if (type === 3) {
        copy(item.content)
      }
      toast.success(params[type]||'操作成功')
    } else {
      toast.error('操作失败')
    }
  }

  return (
    <div ref={messageRef} className="md:p-10">
      {record?.map((item: any, index: number) => {
        return (
          <div key={index} className="my-4">
            {item.isAnswer ? (
              <div className="flex border-b border-solid border-gray-200">
                <div className="w-[35px] h-[35px] flex items-center justify-center explore-item overflow-hidden flex-none  rounded-lg   bg-white p-1">
                  {MODEL_LIST.find(model => model.value === modelId) ? (
                    MODEL_LIST.find(model => model.value === modelId)?.icon
                  ) : (
                    <Avatar
                      value="100%"
                      textSizeRatio={40}
                      // @ts-ignore
                      color={appColor}
                      name="西鲸"
                    />
                  )}
                </div>
                <div
                  // style={{ background: appColor }}
                  className="ml-2 w-[95%] items-start	justify-between py-3 px-4 flex font-bold rounded-tr-2xl rounded-b-2xl"
                >
                  <div className='w-[80%]'><Markdown content={item.content} /></div>
                  {item.actionState && (
                    <div className="flex text-gray-400 ml-[20px] w-[10%]">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        version="1.1"
                        width="12"
                        height="12"
                        viewBox="0 0 20.666667938232422 20"
                        className="cursor-pointer hover:text-gray-800"
                        strokeWidth={1.5}
                        stroke="currentColor"
                        onClick={() => {
                          action(item, 1)
                        }}
                      >
                        <path
                          d="M14.0427,2.23289L14.0546,2.29291L14.0665,2.31692C14.0784,2.34093,14.0784,2.35294,14.0903,2.37695L14.1023,2.43697C14.2453,3.10924,14.3168,3.7695,14.3168,4.44177C14.3168,4.76825,14.2992,5.09118,14.2658,5.41056C14.2379,5.67836,14.1989,5.94367,14.1499,
                      6.20648L14.1023,6.41056L17.4878,6.41056C17.5474,6.41056,17.607,
                      6.41056,17.6666,6.42257L17.75,6.42257C18.7156,6.49459,19.5977,6.9988,
                      20.1342,7.81512L20.1938,7.91116C20.5292,8.47023,20.6963,9.10841,20.6624,9.7599C20.662,
                      9.76783,20.6615,9.77575,20.661,9.78368L20.661,9.78391C20.6607,9.78903,20.6604,9.79416,
                      20.6601,9.79928C20.6606,9.80617,20.6611,9.81305,20.6615,9.81993C20.6681,9.92786,20.6563,
                      10.0348,20.6348,10.1321L20.6229,10.2041L19.6587,14.4766L19.5663,14.8859L18.8944,
                      17.8631C18.8526,18.021,18.7833,18.1696,18.6946,18.309C18.6894,18.3172,18.6841,18.3254,
                      18.6788,18.3335L18.6606,18.3701L18.656,18.3794C18.6523,18.3858,18.6486,18.3923,18.6449,
                      18.3988C18.4076,18.8106,18.0896,19.1639,17.7023,19.4358L17.595,19.5078C17.0944,19.8319,
                      16.5102,20,15.9142,20L1.58546,20C0.739087,20,0.047683,19.3277,0,18.4754L0,9.51981C0,
                      8.7395,0.560276,8.07923,1.33512,7.95918L1.41857,7.94718C3.80272,7.67107,5.36434,
                      7.21489,6.07959,6.61465C7.05709,5.79832,7.83194,4.15366,7.93922,3.13325C8.14188,1.17647,
                      9.31011,0,11.0386,0C12.4095,0,13.6135,0.90036,14.0427,2.23289ZM13.0997,2.61835L13.1324,
                      2.68425Q13.3168,3.56986,13.3168,4.44177Q13.3168,5.2073,13.1709,6.00165L12.8417,
                      7.41056L17.4878,7.41056L17.5074,7.41059L17.5669,7.42257L17.7098,7.42257Q18.733,
                      7.51201,19.2922,8.35481L19.3362,8.42562Q19.7108,9.0499,19.6612,9.74918L19.8124,
                      9.7599L19.6587,9.7599L19.6587,9.91498L19.6583,9.91657L19.6526,9.94252L19.6411,
                      10.0122L17.9242,17.6195Q17.9154,17.6491,17.9012,17.6804L17.7969,17.8555L17.8491,
                      17.8889L17.7961,17.8626L17.7736,17.9079Q17.5227,18.3401,17.1449,18.6055L17.0516,
                      18.6684Q16.5393,19,15.9142,19L1.58546,19Q1.3558,19,1.18757,18.8377Q1.02018,18.6762,
                      1,18.4416L1,9.51981Q1,9.02304,1.47751,8.949L1.54739,8.93894Q5.39914,8.49116,6.72058,
                      7.38219Q7.57856,6.66568,8.22515,5.40759Q8.82918,4.23229,8.9339,3.23627Q9.1655,1,
                      11.0386,1Q11.7341,1,12.2966,1.41883Q12.8458,1.82779,13.074,2.48905L13.0997,
                      2.61835Z"
                        />
                      </svg>

                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        version="1.1"
                        width="12"
                        height="12"
                        viewBox="0 0 20.666667938232422 20"
                        className="ml-1 cursor-pointer hover:text-gray-800"
                        strokeWidth={1.5}
                        stroke="currentColor"
                        onClick={() => {
                          action(item, 2)
                        }}
                      >
                        <g transform="matrix(-1,0,0,-1,41.333335876464844,40)">
                          <path d="M34.70936793823242,22.23289L34.72126793823242,22.29291L34.73316793823242,22.31692C34.745067938232424,22.34093,34.745067938232424,22.35294,34.75696793823242,22.37695L34.76896793823242,22.43697C34.91196793823242,23.10924,34.98346793823242,23.7695,34.98346793823242,24.441769999999998C34.98346793823242,24.768250000000002,34.96586793823242,25.09118,34.93246793823242,25.41056C34.90456793823242,25.678359999999998,34.865567938232424,25.94367,34.816567938232424,26.20648L34.76896793823242,26.41056L38.15446793823242,26.41056C38.21406793823242,26.41056,38.27366793823242,26.41056,38.333267938232424,26.42257L38.41666793823242,26.42257C39.38226793823242,26.49459,40.264367938232425,26.9988,40.80086793823242,27.81512L40.86046793823242,27.91116C41.195867938232425,28.47023,41.36296793823242,29.10841,41.32906793823243,29.759900000000002C41.32866793823242,29.76783,41.328167938232426,29.775750000000002,41.32766793823242,29.78368L41.32766793823242,29.78391C41.32736793823242,29.78903,41.32706793823242,29.794159999999998,41.32676793823242,29.79928C41.327267938232424,29.80617,41.32776793823243,29.81305,41.328167938232426,29.81993C41.33476793823242,29.927860000000003,41.32296793823242,30.0348,41.30146793823242,30.1321L41.28956793823242,30.2041L40.32536793823242,34.4766L40.23296793823242,34.8859L39.561067938232426,37.8631C39.51926793823242,38.021,39.44996793823242,38.1696,39.36126793823242,38.309C39.35606793823242,38.3172,39.35076793823242,38.3254,39.34546793823242,38.3335L39.327267938232424,38.3701L39.32266793823242,38.379400000000004C39.31896793823242,38.3858,39.315267938232424,38.3923,39.31156793823242,38.3988C39.074267938232424,38.8106,38.756267938232426,39.1639,38.36896793823242,39.4358L38.26166793823242,39.5078C37.76106793823242,39.831900000000005,37.17686793823242,40,36.58086793823242,40L22.252127938232423,40C21.405754938232423,40,20.71435093823242,39.3277,20.666667938232422,38.4754L20.666667938232422,29.51981C20.666667938232422,28.7395,21.226943938232424,28.079230000000003,22.00178793823242,27.95918L22.08523793823242,27.94718C24.469387938232423,27.67107,26.03100793823242,27.21489,26.74625793823242,26.61465C27.72375793823242,25.79832,28.49860793823242,24.153660000000002,28.60588793823242,23.13325C28.808547938232422,21.17647,29.976777938232424,20,31.705267938232424,20C33.07616793823242,20,34.280167938232424,20.90036,34.70936793823242,22.23289ZM33.76636793823242,22.61835L33.799067938232426,22.68425Q33.98346793823242,23.56986,33.98346793823242,24.441769999999998Q33.98346793823242,25.2073,33.837567938232425,26.001649999999998L33.508367938232425,27.41056L38.15446793823242,27.41056L38.174067938232426,27.41059L38.233567938232426,27.42257L38.37646793823242,27.42257Q39.399667938232426,27.51201,39.95886793823242,28.35481L40.00286793823243,28.425620000000002Q40.37746793823242,29.0499,40.32786793823242,29.749180000000003L40.47906793823242,29.759900000000002L40.32536793823242,29.759900000000002L40.32536793823242,29.91498L40.32496793823242,29.91657L40.31926793823242,29.942520000000002L40.30776793823242,30.0122L38.59086793823242,37.6195Q38.58206793823243,37.649100000000004,38.567867938232425,37.6804L38.46356793823242,37.8555L38.51576793823242,37.8889L38.46276793823242,37.8626L38.440267938232424,37.9079Q38.18936793823242,38.3401,37.81156793823242,38.6055L37.71826793823242,38.6684Q37.20596793823242,39,36.58086793823242,39L22.252127938232423,39Q22.02246793823242,39,21.854237938232423,38.8377Q21.68684793823242,38.6762,21.666667938232422,38.4416L21.666667938232422,29.51981Q21.666667938232422,29.02304,22.14417793823242,28.948999999999998L22.214057938232422,28.938940000000002Q26.06580793823242,28.49116,27.38724793823242,27.38219Q28.24522793823242,26.665680000000002,28.89181793823242,25.40759Q29.495847938232423,24.23229,29.600567938232423,23.23627Q29.832167938232423,21,31.705267938232424,21Q32.40076793823242,21,32.96326793823242,21.41883Q33.51246793823242,21.82779,33.74066793823242,22.48905L33.76636793823242,22.61835Z" />
                        </g>
                      </svg>

                      <svg
                        className="ml-1 cursor-pointer hover:text-gray-800"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        version="1.1"
                        width="16"
                        height="13"
                        viewBox="0 0 20 20"
                        strokeWidth={1.5}
                        stroke="currentColor"
                        onClick={() => {
                          action(item, 3)
                        }}
                      >
                        <path d="M12,5L9,5L9,16L0,16L0,0L12,0L12,5ZM8,5L8,15L1,15L1,1L11,1L11,4L9,4Q8.90151,4,8.80491,4.01921Q8.70831,4.03843,8.61732,4.07612Q8.52632,4.11381,8.44443,4.16853Q8.36254,4.22325,8.29289,4.29289Q8.22325,4.36254,8.16853,4.44443Q8.11381,4.52632,8.07612,4.61732Q8.03843,4.70831,8.01921,4.80491Q8,4.90151,8,5Z" />
                        <path d="M20,4L8,4L8,20L20,20L20,4ZM9,19L9,5L19,5L19,19L9,19Z" />
                        <path d="M15,9.5L11,9.5L11,8.5L15,8.5L15,9.5Z" />

                        <path d="M17,12.5L11,12.5L11,11.5L17,11.5L17,12.5Z" />

                        <path d="M14,15.5L11,15.5L11,14.5L14,14.5L14,15.5Z" />
                      </svg>

                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        className="ml-1 cursor-pointer	hover:text-gray-800"
                        fill="none"
                        version="1.1"
                        width="14"
                        height="14"
                        viewBox="0 0 23.77294921875 21"
                        onClick={onReload}
                        strokeWidth={1.5}
                        stroke="currentColor"
                      >
                        <g>
                          <g>
                            <path d="M8.529578550262451,18.7329Q6.399758550262451,17.5029,5.129988550262452,15.3956L4.273468550262451,15.9117Q5.676338550262451,18.2399,8.029488550262451,19.5989Q10.45578855026245,21,13.273158550262451,21Q15.40905855026245,21,17.36035855026245,20.1747Q19.244758550262453,19.3776,20.697758550262453,17.9246Q22.150758550262452,16.471600000000002,22.947858550262453,14.5872Q23.77315855026245,12.6359,23.77315855026245,10.5Q23.77315855026245,8.36411,22.947858550262453,6.41277Q22.150758550262452,4.52837,20.697758550262453,3.07538Q19.244758550262453,1.62238,17.36035855026245,0.825346Q15.40905855026245,-0.0000010000000000287557,13.273158550262451,-0.0000010000000000287557Q11.137268550262451,0,9.185928550262451,0.825347Q7.3015385502624515,1.62238,5.848538550262451,3.07538Q4.395538550262451,4.52838,3.5985045502624513,6.41277Q2.773157550262451,8.36411,2.773157550262451,10.5L3.773157550262451,10.5Q3.773157550262451,8.5669,4.519508550262451,6.80232Q5.240558550262451,5.09757,6.555648550262451,3.78249Q7.870728550262451,2.4674,9.575478550262451,1.74635Q11.340058550262452,1,13.273158550262451,0.9999990000000001Q15.20625855026245,0.9999990000000001,16.97085855026245,1.74635Q18.67555855026245,2.4674,19.990658550262452,3.78249Q21.30575855026245,5.09756,22.02675855026245,6.80232Q22.77315855026245,8.56689,22.77315855026245,10.5Q22.77315855026245,12.4331,22.02675855026245,14.1977Q21.30575855026245,15.9024,19.990658550262452,17.2175Q18.67555855026245,18.5326,16.97085855026245,19.2536Q15.20625855026245,20,13.273158550262451,20Q10.723788550262451,20,8.529578550262451,18.7329Z" />
                          </g>
                          <g>
                            <path d="M3.550505625,10.916025850524903L7.836225625,8.058885850524902L7.281525625,7.226835850524902L3.411835625,9.806625850524902L0.832040625,5.936935850524902L-0.00000937499999997815,6.4916358505249026L2.857135625,10.777345850524902Q2.884445625,10.818325850524904,2.919235625,10.853185850524902Q2.954025625,10.888045850524902,2.994935625,10.915445850524902Q3.035855625,10.942845850524902,3.081335625,10.961735850524903Q3.126805625,10.980635850524902,3.175095625,10.990285850524902Q3.223385625,10.999945850524902,3.272635625,10.999995850524902Q3.321875625,11.000055850524902,3.370185625,10.990495850524901Q3.418495625,10.980935850524903,3.464015625,10.962135850524902Q3.509535625,10.943345850524903,3.550505625,10.916025850524903Z" />
                          </g>
                        </g>
                      </svg>
                    </div>
                  )}
                </div>
              </div>
            ) : (
              <div className="flex  mb-6 border-b  border-solid border-gray-200">
                <div className="w-[35px] h-[35px] flex  items-center justify-center explore-item flex-none overflow-hidden rounded-lg   bg-white p-1">
                  {avatar ? (
                    <img alt={avatar} src={avatar} width={50} height={50} />
                  ) : (
                    <Avatar
                      value="86%"
                      textSizeRatio={10}
                      // @ts-ignore
                      color="#159895"
                      name="USER"
                    />
                  )}
                </div>
                <div className="mr-2 w-[95%] py-3 px-4  font-bold rounded-tl-2xl rounded-b-2xl">
                  <Markdown content={item.content} />
                </div>
              </div>
            )}
          </div>
        )
      })}
    </div>
  )
}
export default ChatModal
